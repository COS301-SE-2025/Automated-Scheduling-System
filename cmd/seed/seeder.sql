CREATE TABLE job_positions (
    position_matrix_code VARCHAR(100) PRIMARY KEY NOT NULL,
    job_title VARCHAR(255) NOT NULL,
    description TEXT,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    creation_date TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

-- Create tables
CREATE TABLE employee (
    EmployeeNumber VARCHAR(200) PRIMARY KEY NOT NULL,
    FirstName VARCHAR(255),
    LastName VARCHAR(255),
    UserAccountEmail VARCHAR(255) UNIQUE NOT NULL,
    EmployeeStatus VARCHAR(100),
    PhoneNumber VARCHAR(20) NULL,
    TerminationDate DATE
);

-- The link between an employee and their job position(s)
CREATE TABLE employment_history (
    employment_id INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    employee_number VARCHAR(200) NOT NULL REFERENCES employee(EmployeeNumber) ON DELETE CASCADE,
    position_matrix_code VARCHAR(100) NOT NULL REFERENCES job_positions(position_matrix_code) ON DELETE CASCADE,
    start_date DATE NOT NULL,
    end_date DATE, -- NULL means current position
    employment_type VARCHAR(50) DEFAULT 'Primary',
    notes TEXT,
    UNIQUE(employee_number, position_matrix_code, start_date)
);

CREATE TABLE users (
    id BIGSERIAL PRIMARY KEY,
    username VARCHAR(150) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    forgot_password_link VARCHAR(255) UNIQUE,
    role VARCHAR(50) DEFAULT 'User',
    employee_number VARCHAR(200) NOT NULL,
    CONSTRAINT fk_employee FOREIGN KEY (employee_number) REFERENCES employee(EmployeeNumber) ON DELETE CASCADE
);

-- EVENTS

-- Type definition remains the same
CREATE TYPE event_source_enum AS ENUM ('LMS', 'Custom');

-- competency types, e.g. certification, licence etc.
CREATE TABLE competency_types (
    type_name VARCHAR(100) PRIMARY KEY,
    description TEXT,
    is_active BOOLEAN NOT NULL DEFAULT TRUE
);

-- Populated through LMSJobCompetencyMatrix, and when HR makes new competencies.
CREATE TABLE competency_definitions (
    competency_id INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    competency_name VARCHAR(255) NOT NULL,
    description TEXT,
    -- Mirrors CompetencyTypeName (e.g., 'Certification', 'Skill', 'License').
    competency_type_name VARCHAR(100) REFERENCES competency_types(type_name),
    -- Distinguish between LMS data and user-created data.
    source event_source_enum NOT NULL,
    -- Defines the validity period in months after which this competency expires (mainly for Custom Competencies).
    expiry_period_months INT NULL,
    -- Allows HR to deactivate a custom competency without deleting it, preserving history.
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    creation_date TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (competency_name, source)
);

-- Depends on competency_definitions.
CREATE TABLE competency_prerequisites (
    competency_id INT NOT NULL REFERENCES competency_definitions(competency_id) ON DELETE CASCADE,
    prerequisite_competency_id INT NOT NULL REFERENCES competency_definitions(competency_id) ON DELETE CASCADE,
    PRIMARY KEY (competency_id, prerequisite_competency_id)
);

-- Depends on competency_definitions.
-- Stores the definition/template for events created by HR
CREATE TABLE custom_event_definitions (
    custom_event_id INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    event_name VARCHAR(255) NOT NULL,
    activity_description TEXT,
    standard_duration INTERVAL,
    -- Links to the master competency table
    grants_certificate_id INT NULL REFERENCES competency_definitions(competency_id),
    facilitator VARCHAR(255),
    created_by VARCHAR(100),
    creation_date TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

-- Depends on competency_definitions.
CREATE TABLE custom_job_matrix (
    custom_matrix_id INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    position_matrix_code VARCHAR(100) NOT NULL,
    -- Foreign key to master certification table.
    competency_id INT NOT NULL REFERENCES competency_definitions(competency_id) ON DELETE CASCADE,
    requirement_status VARCHAR(50) NOT NULL, -- e.g. 'Required', 'Optional'
    notes TEXT,
    created_by VARCHAR(100),
    creation_date TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_job_position FOREIGN KEY (position_matrix_code) REFERENCES job_positions(position_matrix_code) ON DELETE CASCADE
);

-- Depends on custom_event_definitions.
-- Many-to-many relationship defining prerequisites for events.
CREATE TABLE custom_event_prerequisites (
    event_id INT NOT NULL REFERENCES custom_event_definitions(custom_event_id) ON DELETE CASCADE,
    prerequisite_event_id INT NOT NULL REFERENCES custom_event_definitions(custom_event_id) ON DELETE CASCADE,
    PRIMARY KEY (event_id, prerequisite_event_id)
);

-- Depends on custom_event_definitions.
CREATE TABLE custom_event_schedules (
    custom_event_schedule_id INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    custom_event_id INT NOT NULL REFERENCES custom_event_definitions(custom_event_id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    event_start_date TIMESTAMPTZ NOT NULL,
    event_end_date TIMESTAMPTZ NOT NULL,
    room_name VARCHAR(100),
    maximum_attendees INT,
    minimum_attendees INT,
    status_name VARCHAR(50) DEFAULT 'Scheduled', -- e.g., 'Scheduled', 'Cancelled', 'Full'
    color VARCHAR(7) DEFAULT '#3788d8',
    creation_date TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    created_by_user_id BIGINT NULL DEFAULT NULL REFERENCES users(id)
);

-- Link scheduled events to employees and job positions
CREATE TABLE IF NOT EXISTS event_schedule_employees (
    schedule_employee_id BIGSERIAL PRIMARY KEY,
    custom_event_schedule_id INT NOT NULL REFERENCES custom_event_schedules(custom_event_schedule_id) ON DELETE CASCADE,
    employee_number VARCHAR(200) NOT NULL REFERENCES employee(EmployeeNumber) ON DELETE CASCADE,
    role VARCHAR(50) DEFAULT 'Attendee', -- Selected -> booked/rejected
    UNIQUE(custom_event_schedule_id, employee_number)
);

CREATE TABLE IF NOT EXISTS event_schedule_position_targets (
    schedule_position_id BIGSERIAL PRIMARY KEY,
    custom_event_schedule_id INT NOT NULL REFERENCES custom_event_schedules(custom_event_schedule_id) ON DELETE CASCADE,
    position_matrix_code VARCHAR(100) NOT NULL REFERENCES job_positions(position_matrix_code) ON DELETE CASCADE,
    UNIQUE(custom_event_schedule_id, position_matrix_code)
);

-- Track attendance per employee per scheduled event
CREATE TABLE IF NOT EXISTS event_attendance (
    id BIGSERIAL PRIMARY KEY,
    custom_event_schedule_id INT NOT NULL REFERENCES custom_event_schedules(custom_event_schedule_id) ON DELETE CASCADE,
    employee_number VARCHAR(200) NOT NULL REFERENCES employee(EmployeeNumber) ON DELETE CASCADE,
    -- Default to false; UI/handler will explicitly set true for attendees.
    attended BOOLEAN NOT NULL DEFAULT FALSE,
    check_in_time TIMESTAMPTZ NULL,
    check_out_time TIMESTAMPTZ NULL,
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(custom_event_schedule_id, employee_number)
);

-- This table tracks which employee has which certification.
CREATE TABLE employee_competencies (
    employee_competency_id INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    employee_number VARCHAR(200) NOT NULL REFERENCES employee(EmployeeNumber) ON DELETE CASCADE,
    competency_id INT NOT NULL REFERENCES competency_definitions(competency_id) ON DELETE CASCADE,
    achievement_date DATE,
    expiry_date DATE,
    granted_by_schedule_id INT NULL REFERENCES custom_event_schedules(custom_event_schedule_id),
    notes TEXT,
    UNIQUE (employee_number, competency_id, achievement_date)
);

-- Indexes updated to match new column names
CREATE INDEX idx_customeventdefinition_grants_cert_id ON custom_event_definitions(grants_certificate_id);
CREATE INDEX idx_customjobmatrix_competency_id ON custom_job_matrix(competency_id);
CREATE INDEX idx_customeventschedule_custom_event_id ON custom_event_schedules(custom_event_id);
CREATE INDEX IF NOT EXISTS idx_event_attendance_schedule ON event_attendance(custom_event_schedule_id);
CREATE INDEX IF NOT EXISTS idx_event_attendance_employee ON event_attendance(employee_number);

-- Insert dummy data
-- Insert data into the employee table
INSERT INTO employee (EmployeeNumber, FirstName, LastName, UserAccountEmail, EmployeeStatus, PhoneNumber, TerminationDate)
VALUES
('E001', 'John', 'Doe', 'john.doe@example.com', 'Active', '0123456789', NULL),
('E002', 'Jane', 'Smith', 'jane.smith@example.com', 'Active', '0123456789', NULL),
('E003', 'Alice', 'Johnson', 'alice.johnson@example.com', 'Terminated', '0123456789', '2025-06-01'),
('E004', 'Bob', 'Brown', 'bob.brown@example.com', 'Active', '0123456789', NULL)
ON CONFLICT (EmployeeNumber) DO NOTHING;

-- Insert data into the users table
-- Password is set to: Pa$$w0rd!
INSERT INTO users (username, password, forgot_password_link, role, employee_number)
VALUES
('johndoe', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'Admin', 'E001'),
('janesmith', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E002'),
('alicejohnson', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E003')
ON CONFLICT (username) DO NOTHING;

-- ROLES and permissions
CREATE TABLE roles (
    role_id INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    role_name VARCHAR(100) NOT NULL UNIQUE,
    description TEXT
);

CREATE TABLE role_permissions (
    role_id INT NOT NULL REFERENCES roles(role_id) ON DELETE CASCADE,
    page VARCHAR(100) NOT NULL,
    PRIMARY KEY (role_id, page)
);

CREATE TABLE user_has_role (
    user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    role_id INT NOT NULL REFERENCES roles(role_id) ON DELETE CASCADE,
    PRIMARY KEY (user_id, role_id)
);

-- Seed default roles mirroring legacy roles
INSERT INTO roles (role_name, description) VALUES
('Admin', 'Built-in admin with full access') ON CONFLICT DO NOTHING;
INSERT INTO roles (role_name, description) VALUES ('User', 'Default user') ON CONFLICT DO NOTHING;
INSERT INTO roles (role_name, description) VALUES ('HR', 'Human Resources role with scheduling privileges') ON CONFLICT DO NOTHING;

-- Admin gets all pages
INSERT INTO role_permissions (role_id, page)
SELECT r.role_id, p.page FROM roles r CROSS JOIN (VALUES
 ('dashboard'), ('users'), ('roles'), ('compliance dashboard'), ('calendar'), ('event-definitions'), ('events'), ('rules'), ('competencies'), ('main-help')
) AS p(page)
WHERE r.role_name = 'Admin';

-- User role baseline
INSERT INTO role_permissions (role_id, page)
SELECT r.role_id, p.page FROM roles r, (VALUES
 ('dashboard'), ('calendar'), ('events'), ('main-help')
) AS p(page)
WHERE r.role_name = 'User';

-- HR role permissions
INSERT INTO role_permissions (role_id, page)
SELECT r.role_id, p.page FROM roles r, (VALUES
 ('dashboard'), ('calendar'), ('events'), ('event-definitions'), ('competencies'), ('main-help')
) AS p(page)
WHERE r.role_name = 'HR';

-- Link seeded users to roles
INSERT INTO user_has_role (user_id, role_id)
SELECT u.id, r.role_id FROM users u JOIN roles r ON ((u.role = 'Admin' AND r.role_name = 'Admin') OR (u.role = 'User' AND r.role_name = 'User'));

-- =============================================================================
-- MOCK DATA INSERTION SCRIPT (CORRECTED ORDER)
-- =============================================================================

-- -----------------------------------------------------------------------------
-- Additional mock data: expanded sets for more realistic testing
-- The inserts use ON CONFLICT DO NOTHING so the script is idempotent.
-- -----------------------------------------------------------------------------

-- More job positions (adds broader variety)
INSERT INTO job_positions (position_matrix_code, job_title, description, is_active) VALUES
('P008', 'Maintenance Technician', 'Performs routine and corrective maintenance.', TRUE),
('P009', 'Quality Inspector', 'Inspects products and ensures quality standards.', TRUE),
('P010', 'Customer Service Rep', 'Handles customer enquiries and feedback.', TRUE),
('P011', 'Inventory Clerk', 'Manages stock and warehouse inventory.', TRUE),
('P012', 'Scheduler', 'Plans and schedules field work and training.', TRUE),
('P013', 'Safety Coordinator', 'Coordinates safety initiatives and audits.', TRUE),
('P014', 'Field Engineer', 'Advanced diagnostics and field engineering.', TRUE),
('P015', 'Trainer', 'Delivers internal training courses.', TRUE),
('P016', 'IT Support', 'Provides technical support for systems.', TRUE),
('P017', 'Procurement Officer', 'Handles purchasing and supplier management.', TRUE),
('P018', 'Compliance Officer', 'Ensures regulatory and standards compliance.', TRUE),
('P019', 'HR Generalist', 'Supports HR activities and employee relations.', TRUE),
('P020', 'Operations Analyst', 'Analyzes operations and process improvements.', TRUE)
ON CONFLICT (position_matrix_code) DO NOTHING;

-- Additional competency types
INSERT INTO competency_types (type_name, description) VALUES
('Compliance', 'Regulatory and compliance related competencies.'),
('Quality', 'Quality assurance and inspection competencies.'),
('Customer Service', 'Skills for customer-facing roles.'),
('IT', 'Information technology and systems competencies.'),
('Management', 'Management and leadership skills.')
ON CONFLICT (type_name) DO NOTHING;

-- More employees for larger test coverage
INSERT INTO employee (EmployeeNumber, FirstName, LastName, UserAccountEmail, EmployeeStatus, TerminationDate)
VALUES
('E011','Liam','Anderson','liam.anderson@example.com','Active',NULL),
('E012','Noah','Thompson','noah.thompson@example.com','Active',NULL),
('E013','Emma','Williams','emma.williams@example.com','Active',NULL),
('E014','Olivia','Brown','olivia.brown@example.com','Active',NULL),
('E015','Ava','Jones','ava.jones@example.com','Active',NULL),
('E016','Sophia','Garcia','sophia.garcia@example.com','Active',NULL),
('E017','Isabella','Martinez','isabella.martinez@example.com','Active',NULL),
('E018','Mia','Rodriguez','mia.rodriguez@example.com','Active',NULL),
('E019','Amelia','Hernandez','amelia.hernandez@example.com','On Leave',NULL),
('E020','Evelyn','Lopez','evelyn.lopez@example.com','Active',NULL),
('E021','James','Gonzalez','james.gonzalez@example.com','Active',NULL),
('E022','Benjamin','Wilson','benjamin.wilson@example.com','Active',NULL),
('E023','Lucas','Andrews','lucas.andrews@example.com','Active',NULL),
('E024','Henry','Perez','henry.perez@example.com','Active',NULL),
('E025','Alexander','Sanchez','alex.sanchez@example.com','Active',NULL),
('E026','Michael','Ramirez','michael.ramirez@example.com','Active',NULL),
('E027','Daniel','Torres','daniel.torres@example.com','Active',NULL),
('E028','Matthew','Nguyen','matthew.nguyen@example.com','Active',NULL),
('E029','Elijah','Khan','elijah.khan@example.com','Active',NULL),
('E030','Ella','Murphy','ella.murphy@example.com','Active',NULL)
ON CONFLICT (EmployeeNumber) DO NOTHING;

-- Corresponding users (passwords reuse seeded hash above) and roles
INSERT INTO users (username, password, forgot_password_link, role, employee_number)
VALUES
('liamanderson', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E011'),
('noahthompson', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E012'),
('emmawilliams', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E013'),
('oliviabrown', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E014'),
('avajones', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E015'),
('sophiagarcia', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E016'),
('isabellamartinez', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E017'),
('miarodriguez', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E018'),
('ameliahernandez', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E019'),
('evelynlopez', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E020'),
('jamesgonzalez', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E021'),
('benjaminwilson', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E022'),
('lucasandrews', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E023'),
('henryperez', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E024'),
('alexandersanchez', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E025'),
('michaelramirez', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E026'),
('danieltorres', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E027'),
('matthewnguyen', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E028'),
('elijahkhan', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E029'),
('ellamurphy', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', NULL, 'User', 'E030')
ON CONFLICT (username) DO NOTHING;

-- Additional competency definitions (wide coverage)
-- Ensure base competency types exist so competency_definitions can reference them
INSERT INTO competency_types (type_name, description) VALUES
('Certification', 'Official certification from an accredited body.'),
('License', 'A legal license required to perform certain tasks.'),
('Skill', 'A demonstrated ability or skill.'),
('Internal Training', 'A competency granted after completing internal training.'),
('Soft Skill', 'Interpersonal and communication skills.')
ON CONFLICT (type_name) DO NOTHING;

INSERT INTO competency_definitions (competency_name, description, competency_type_name, source, expiry_period_months, is_active) VALUES
('Electrical Safety', 'Safe working practices around electrical systems.', 'Certification', 'Custom', 24, TRUE),
('Hazardous Materials Handling', 'Safe handling and storage of hazardous substances.', 'Certification', 'Custom', 36, TRUE),
('Customer Interaction', 'Professional customer communication skills.', 'Customer Service', 'Custom', NULL, TRUE),
('Quality Assurance Basics', 'Intro to QA and inspection techniques.', 'Quality', 'Custom', NULL, TRUE),
('ISO 9001 Awareness', 'Overview of ISO 9001 principles.', 'Compliance', 'LMS', NULL, TRUE),
('Data Security Basics', 'Fundamentals of data protection and security.', 'IT', 'LMS', NULL, TRUE),
('Linux Server Maintenance', 'Administer basic Linux servers.', 'IT', 'Custom', NULL, TRUE),
('Network Fundamentals', 'Networking basics for support staff.', 'IT', 'Custom', NULL, TRUE),
('Excel Advanced', 'Advanced spreadsheet and data analysis skills.', 'Skill', 'Custom', NULL, TRUE),
('Communication Skills', 'Effective verbal and written communication.', 'Soft Skill', 'Custom', NULL, TRUE),
('Conflict Resolution', 'Resolve interpersonal conflicts professionally.', 'Management', 'Custom', NULL, TRUE),
('Time Management', 'Prioritisation and personal productivity techniques.', 'Skill', 'Custom', NULL, TRUE),
('Advanced Leadership', 'Leadership skills for senior staff.', 'Management', 'Custom', NULL, TRUE),
('Mentoring 101', 'Basics of mentoring and coaching.', 'Management', 'Custom', NULL, TRUE),
('Root Cause Analysis', 'Investigative techniques to find underlying causes.', 'Quality', 'Custom', NULL, TRUE),
('Preventive Maintenance', 'Planned maintenance strategies and checks.', 'Skill', 'Custom', NULL, TRUE),
('Emergency Response', 'Responding to emergencies and incident management.', 'Certification', 'Custom', 12, TRUE),
('Ergonomics Awareness', 'Workplace ergonomics to reduce injuries.', 'Compliance', 'Custom', NULL, TRUE)
ON CONFLICT (competency_name, source) DO NOTHING;

-- Employment history: assign many employees to positions
-- Ensure core job positions P001-P007 exist before assigning employment history
INSERT INTO job_positions (position_matrix_code, job_title, description, is_active) VALUES
('P001', 'Technician', 'Field technician', TRUE),
('P002', 'Supervisor', 'Team supervisor', TRUE),
('P003', 'Senior Technician', 'Leads technical projects and mentors junior technicians.', TRUE),
('P004', 'Field Trainee', 'Entry-level position, learning on the job.', TRUE),
('P005', 'Operations Manager', 'Manages day-to-day operations and staff.', TRUE),
('P006', 'Safety Officer', 'Ensures compliance with safety regulations.', TRUE),
('P007', 'Lead Engineer', 'Designs and oversees engineering projects.', FALSE)
ON CONFLICT (position_matrix_code) DO NOTHING;

INSERT INTO employment_history (employee_number, position_matrix_code, start_date, end_date, employment_type)
VALUES
('E011','P008','2022-03-01',NULL,'Primary'),
('E012','P009','2021-10-15',NULL,'Primary'),
('E013','P010','2023-01-12',NULL,'Primary'),
('E014','P011','2020-07-01',NULL,'Primary'),
('E015','P012','2024-02-01',NULL,'Primary'),
('E016','P013','2022-11-01',NULL,'Primary'),
('E017','P014','2023-06-01',NULL,'Primary'),
('E018','P015','2021-05-20',NULL,'Primary'),
('E019','P001','2019-09-01',NULL,'Primary'),
('E020','P003','2020-12-01',NULL,'Primary'),
('E021','P008','2024-01-01',NULL,'Primary'),
('E022','P009','2023-09-01',NULL,'Primary'),
('E023','P010','2022-08-01',NULL,'Primary'),
('E024','P011','2021-04-01',NULL,'Primary'),
('E025','P012','2020-06-01',NULL,'Primary'),
('E026','P013','2019-11-01',NULL,'Primary'),
('E027','P014','2022-02-01',NULL,'Primary'),
('E028','P015','2023-03-01',NULL,'Primary'),
('E029','P016','2024-05-01',NULL,'Primary'),
('E030','P017','2021-01-01',NULL,'Primary')
ON CONFLICT (employee_number, position_matrix_code, start_date) DO NOTHING;

-- Competency prerequisites using names (safer than hard-coded IDs)
INSERT INTO competency_prerequisites (competency_id, prerequisite_competency_id)
SELECT c.competency_id, p.competency_id FROM (VALUES
 ('Advanced Widget Repair','Basic Widget Repair'),
 ('Advanced Leadership','Leadership Foundations'),
 ('Mentoring 101','Leadership Foundations'),
 ('Root Cause Analysis','Quality Assurance Basics')
) AS v(cname, pname)
JOIN competency_definitions c ON c.competency_name = v.cname
JOIN competency_definitions p ON p.competency_name = v.pname
ON CONFLICT DO NOTHING;

-- Custom job matrix entries linking positions to competencies (use lookups)
INSERT INTO custom_job_matrix (position_matrix_code, competency_id, requirement_status, notes, created_by)
SELECT v.pos, cd.competency_id, v.req, NULL, v.created_by FROM (VALUES
 ('P001','Required','First Aid Level 1','johndoe'),
 ('P001','Required','Basic Widget Repair','johndoe'),
 ('P003','Required','Advanced Widget Repair','johndoe'),
 ('P002','Required','Leadership Foundations','bobbrown'),
 ('P005','Required','Leadership Foundations','bobbrown'),
 ('P006','Required','Confined Space Entry','johndoe'),
 ('P009','Required','Quality Assurance Basics','pm-admin'),
 ('P010','Required','Customer Interaction','pm-admin'),
 ('P016','Required','Data Security Basics','it-admin'),
 ('P016','Optional','Linux Server Maintenance','it-admin')
) AS v(pos, req, cname, created_by)
JOIN competency_definitions cd ON cd.competency_name = v.cname
ON CONFLICT DO NOTHING;

-- Additional custom event definitions (using competency names for grants_certificate)
INSERT INTO custom_event_definitions (event_name, activity_description, standard_duration, grants_certificate_id, facilitator, created_by)
SELECT v.event_name, v.evt_desc, v.dur::interval, cd.competency_id, v.fac, v.created_by FROM (VALUES
 ('Electrical Safety Course','Covers safe electrical work and lockout/tagout procedures.','1 day','Electrical Safety','St. John','bobbrown'),
 ('Hazmat Handling','Handling and transport of hazardous materials.','2 days','Hazardous Materials Handling','ACME Trainers','johndoe'),
 ('Customer Service Excellence','Workshop on customer-facing best practices.','1 day','Customer Interaction','CustomerCoach','johndoe'),
 ('Quality Inspection Bootcamp','Hands-on quality inspection training.','2 days','Quality Assurance Basics','QA Team','johndoe'),
 ('Linux Admin Fundamentals','Intro to Linux server maintenance.','3 days','Linux Server Maintenance','IT Trainer','it-admin')
) AS v(event_name, evt_desc, dur, cname, fac, created_by)
LEFT JOIN competency_definitions cd ON cd.competency_name = v.cname
ON CONFLICT DO NOTHING;

-- Event prerequisites (link events by name)
INSERT INTO custom_event_prerequisites (event_id, prerequisite_event_id)
SELECT e.custom_event_id, p.custom_event_id FROM (VALUES
 ('Advanced Widget Repair Workshop','Basic Widget Repair Training')
) AS v(en, pn)
JOIN custom_event_definitions e ON e.event_name = v.en
JOIN custom_event_definitions p ON p.event_name = v.pn
ON CONFLICT DO NOTHING;

-- Create schedules for the new events
INSERT INTO custom_event_schedules (custom_event_id, title, event_start_date, event_end_date, room_name, maximum_attendees, minimum_attendees, status_name, color, created_by_user_id)
SELECT ced.custom_event_id, v.title, v.ev_start, v.ev_end, v.room, v.max, v.min, v.status, v.color, u.id FROM (
 VALUES
 ('Electrical Safety - May', 'Electrical Safety Course', NOW() + INTERVAL '10 days', NOW() + INTERVAL '10 days' + INTERVAL '8 hours', 'Room A', 20, 5, 'Scheduled', '#FF8A65'),
 ('Hazmat - June', 'Hazmat Handling', NOW() + INTERVAL '25 days', NOW() + INTERVAL '27 days', 'Room B', 15, 5, 'Scheduled', '#FF7043'),
 ('Customer Service - Online', 'Customer Service Excellence', NOW() + INTERVAL '5 days', NOW() + INTERVAL '5 days' + INTERVAL '8 hours', 'Virtual', 100, 10, 'Scheduled', '#42A5F5'),
 ('QA Bootcamp - Past', 'Quality Inspection Bootcamp', NOW() - INTERVAL '60 days', NOW() - INTERVAL '58 days', 'Workshop Hall', 12, 4, 'Completed', '#66BB6A'),
 ('Linux Admin - Aug', 'Linux Admin Fundamentals', NOW() + INTERVAL '40 days', NOW() + INTERVAL '42 days', 'IT Lab', 10, 2, 'Scheduled', '#8E24AA')
 ) AS v(title, title2, ev_start, ev_end, room, max, min, status, color)
JOIN custom_event_definitions ced ON ced.event_name = v.title2
LEFT JOIN users u ON u.username = 'bobbrown'
ON CONFLICT DO NOTHING;

-- Map some employees directly to schedules
INSERT INTO event_schedule_employees (custom_event_schedule_id, employee_number)
VALUES
((SELECT custom_event_schedule_id FROM custom_event_schedules WHERE title LIKE 'Electrical Safety - May' LIMIT 1),'E011'),
((SELECT custom_event_schedule_id FROM custom_event_schedules WHERE title LIKE 'Electrical Safety - May' LIMIT 1),'E012'),
((SELECT custom_event_schedule_id FROM custom_event_schedules WHERE title LIKE 'Hazmat - June' LIMIT 1),'E013'),
((SELECT custom_event_schedule_id FROM custom_event_schedules WHERE title LIKE 'Customer Service - Online' LIMIT 1),'E014'),
((SELECT custom_event_schedule_id FROM custom_event_schedules WHERE title LIKE 'QA Bootcamp - Past' LIMIT 1),'E004')
ON CONFLICT DO NOTHING;

-- Map schedule position targets (example)
INSERT INTO event_schedule_position_targets (custom_event_schedule_id, position_matrix_code)
VALUES
((SELECT custom_event_schedule_id FROM custom_event_schedules WHERE title LIKE 'Electrical Safety - May' LIMIT 1),'P001'),
((SELECT custom_event_schedule_id FROM custom_event_schedules WHERE title LIKE 'Linux Admin - Aug' LIMIT 1),'P016'),
((SELECT custom_event_schedule_id FROM custom_event_schedules WHERE title LIKE 'Customer Service - Online' LIMIT 1),'P010')
ON CONFLICT DO NOTHING;

-- Some attendance records for the past QA Bootcamp
INSERT INTO event_attendance (custom_event_schedule_id, employee_number, attended, check_in_time, check_out_time)
VALUES
((SELECT custom_event_schedule_id FROM custom_event_schedules WHERE title LIKE 'QA Bootcamp - Past' LIMIT 1),'E004', TRUE, NOW() - INTERVAL '60 days' + INTERVAL '00:10:00', NOW() - INTERVAL '58 days' - INTERVAL '00:05:00'),
((SELECT custom_event_schedule_id FROM custom_event_schedules WHERE title LIKE 'QA Bootcamp - Past' LIMIT 1),'E003', TRUE, NOW() - INTERVAL '60 days' + INTERVAL '00:08:00', NOW() - INTERVAL '58 days' - INTERVAL '00:10:00')
ON CONFLICT DO NOTHING;

-- Give a variety of employees some competencies (achievements)
INSERT INTO employee_competencies (employee_number, competency_id, achievement_date, expiry_date, granted_by_schedule_id, notes)
SELECT v.emp, cd.competency_id, v.ach::date, v.exp::date, s.custom_event_schedule_id, v.note FROM (
 VALUES
 ('E001','2024-03-05', '2027-03-05', 'First Aid Level 1','Granted via past session'),
 ('E005','2024-06-01', NULL, 'Basic Widget Repair','Completed basic training'),
 ('E006','2024-06-02', NULL, 'Basic Widget Repair','Completed basic training'),
 ('E011','2024-05-15', '2026-05-15', 'Electrical Safety','Company course'),
 ('E012','2024-06-18', '2027-06-18', 'Hazardous Materials Handling','Provider cert'),
 ('E013','2024-04-20', NULL, 'Customer Interaction','Workshop attendance'),
 ('E020','2023-11-01', NULL, 'Leadership Foundations','Past enrollment'),
 ('E028','2024-01-20', NULL, 'Linux Server Maintenance','IT course')
 ) AS v(emp, ach, exp, cname, note)
JOIN competency_definitions cd ON cd.competency_name = v.cname
LEFT JOIN custom_event_schedules s ON s.title LIKE '%Past%'
ON CONFLICT DO NOTHING;

-- Ensure role to user mappings exist for the newly created users (map to default 'User' role)
INSERT INTO user_has_role (user_id, role_id)
SELECT u.id, r.role_id FROM users u JOIN roles r ON r.role_name = 'User' WHERE u.username IN (
 'liamanderson','noahthompson','emmawilliams','oliviabrown','avajones','sophiagarcia','isabellamartinez','miarodriguez','ameliahernandez','evelynlopez','jamesgonzalez','benjaminwilson','lucasandrews','henryperez','alexandersanchez','michaelramirez','danieltorres','matthewnguyen','elijahkhan','ellamurphy'
) ON CONFLICT DO NOTHING;


-- -----------------------------------------------------------------------------
-- Stage 1: Core Reference Data (No Dependencies)

-- Insert all job positions FIRST, as other tables depend on them.
INSERT INTO job_positions (position_matrix_code, job_title, description, is_active) VALUES
('P001', 'Technician', 'Field technician', TRUE),
('P002', 'Supervisor', 'Team supervisor', TRUE),
('P003', 'Senior Technician', 'Leads technical projects and mentors junior technicians.', TRUE),
('P004', 'Field Trainee', 'Entry-level position, learning on the job.', TRUE),
('P005', 'Operations Manager', 'Manages day-to-day operations and staff.', TRUE),
('P006', 'Safety Officer', 'Ensures compliance with safety regulations.', TRUE),
('P007', 'Lead Engineer', 'Designs and oversees engineering projects.', FALSE) -- Inactive position example
ON CONFLICT (position_matrix_code) DO NOTHING;

-- Insert competency types
INSERT INTO competency_types (type_name, description) VALUES
('Certification', 'Official certification from an accredited body.'),
('License', 'A legal license required to perform certain tasks.'),
('Skill', 'A demonstrated ability or skill.'),
('Internal Training', 'A competency granted after completing internal training.')
ON CONFLICT (type_name) DO NOTHING;

-- Seed default roles
INSERT INTO roles (role_name, description) VALUES
('Admin', 'Built-in admin with full access'),
('User', 'Default user with basic access'),
('HR', 'Human Resources role with scheduling privileges')
ON CONFLICT (role_name) DO NOTHING;

-- -----------------------------------------------------------------------------
-- Stage 2: Core Entity Data & Dependent Reference Data
-- -----------------------------------------------------------------------------

-- Insert all employees
INSERT INTO employee (EmployeeNumber, FirstName, LastName, UserAccountEmail, EmployeeStatus, TerminationDate) VALUES
('E005', 'Sarah', 'Lee', 'sarah.lee@example.com', 'Active', NULL),
('E006', 'Mike', 'Chen', 'mike.chen@example.com', 'Active', NULL),
('E007', 'David', 'Garcia', 'david.garcia@example.com', 'Active', NULL),
('E008', 'Emily', 'Carter', 'emily.carter@example.com', 'On Leave', NULL),
('E009', 'Chris', 'Wright', 'chris.wright@example.com', 'Active', NULL),
('E010', 'Olivia', 'Martinez', 'olivia.martinez@example.com', 'Terminated', '2023-11-20')
ON CONFLICT (EmployeeNumber) DO NOTHING;

-- Insert all users (depends on employees)
-- All passwords are 'Pa$$w0rd!'
INSERT INTO users (username, password, role, employee_number) VALUES
('sarahlee', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', 'User', 'E005'),
('mikechen', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', 'User', 'E006'),
('davidgarcia', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', 'User', 'E007'),
('emilycarter', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', 'User', 'E008')
ON CONFLICT (username) DO NOTHING;
-- Ensure Bob Brown user exists for created_by fields in schedules and definitions
INSERT INTO users (username, password, role, employee_number) VALUES
('bobbrown', '$2a$10$gca/UYFWZXMD/xBOLKntSeD.fFmE2IdzdqSD1qxFvcuJgDyfd17Qq', 'User', 'E004')
ON CONFLICT (username) DO NOTHING;

-- Insert competency definitions (depends on competency_types)
INSERT INTO competency_definitions (competency_name, description, competency_type_name, source, expiry_period_months, is_active) VALUES
('First Aid Level 1', 'Basic first aid and CPR.', 'Certification', 'Custom', 36, TRUE), -- ID: 1
('Forklift Operation', 'Certified to operate a forklift.', 'License', 'LMS', 24, TRUE), -- ID: 2
('Working at Heights', 'Safety procedures for working at elevated positions.', 'Certification', 'Custom', 24, TRUE), -- ID: 3
('Confined Space Entry', 'Procedures for entering and working in confined spaces.', 'Certification', 'Custom', 36, TRUE), -- ID: 4
('Basic Widget Repair', 'Introductory course for widget maintenance.', 'Internal Training', 'Custom', NULL, TRUE), -- ID: 5
('Advanced Widget Repair', 'Advanced troubleshooting and repair of complex widgets.', 'Internal Training', 'Custom', NULL, TRUE), -- ID: 6
('Leadership Foundations', 'Core skills for new supervisors and managers.', 'Internal Training', 'Custom', NULL, TRUE), -- ID: 7
('Project Management Basics', 'Introduction to project management principles from an external provider.', 'Skill', 'LMS', NULL, TRUE), -- ID: 8
('Safety Procedures 101', 'General company safety protocols.', 'Internal Training', 'Custom', 12, FALSE) -- ID: 9 (Inactive example)
ON CONFLICT (competency_name, source) DO NOTHING;

-- -----------------------------------------------------------------------------
-- Stage 3: Link Tables & History (Depends on Stages 1 & 2)
-- -----------------------------------------------------------------------------

-- Insert employment history (depends on employees and job_positions)
INSERT INTO employment_history (employee_number, position_matrix_code, start_date, end_date, employment_type) VALUES
('E001', 'P001', '2020-01-01', NULL, 'Primary'),
('E002', 'P004', '2020-09-01', '2021-02-28', 'Primary'), -- Jane was a trainee first
('E002', 'P001', '2021-03-01', NULL, 'Primary'),
('E003', 'P001', '2019-05-15', '2025-06-01', 'Primary'), -- Alice's terminated role
('E004', 'P002', '2022-06-01', NULL, 'Primary'),
('E005', 'P005', '2021-08-10', NULL, 'Primary'),
('E006', 'P003', '2022-02-20', NULL, 'Primary'),
('E007', 'P001', '2023-01-15', NULL, 'Primary'),
('E008', 'P001', '2022-07-01', NULL, 'Primary'),
('E009', 'P004', '2024-02-01', NULL, 'Primary')
ON CONFLICT (employee_number, position_matrix_code, start_date) DO NOTHING;

-- Insert competency prerequisites (depends on competency_definitions)
-- Assumes competency IDs are generated sequentially from 1
INSERT INTO competency_prerequisites (competency_id, prerequisite_competency_id) VALUES
(6, 5) ON CONFLICT DO NOTHING; -- Advanced Widget Repair requires Basic Widget Repair

-- Insert custom job matrix (depends on job_positions and competency_definitions)
INSERT INTO custom_job_matrix (position_matrix_code, competency_id, requirement_status, notes, created_by) VALUES
('P001', 1, 'Required', 'All technicians must have current First Aid.', 'johndoe'),
('P001', 5, 'Required', 'Core skill for the role.', 'johndoe'),
('P001', 3, 'Optional', 'Required for specific sites only.', 'johndoe'),
('P003', 6, 'Required', 'Senior techs must be able to handle all repairs.', 'johndoe'),
('P003', 1, 'Required', 'Team leads must be first aid certified.', 'johndoe'),
('P002', 7, 'Required', 'Essential for supervisory duties.', 'bobbrown'),
('P005', 7, 'Required', 'Essential for management duties.', 'bobbrown'),
('P006', 4, 'Required', 'Core competency for Safety Officers.', 'johndoe')
ON CONFLICT DO NOTHING;

-- Link users to roles
INSERT INTO user_has_role (user_id, role_id)
SELECT u.id, r.role_id FROM users u JOIN roles r ON u.role = r.role_name
ON CONFLICT (user_id, role_id) DO NOTHING;

-- Set up role permissions (depends on roles)
-- Admin gets all pages
INSERT INTO role_permissions (role_id, page)
SELECT r.role_id, p.page FROM roles r CROSS JOIN (VALUES
 ('dashboard'), ('users'), ('roles'), ('calendar'), ('event-definitions'), ('events'), ('rules'), ('competencies'), ('main-help')
) AS p(page)
WHERE r.role_name = 'Admin' ON CONFLICT DO NOTHING;
-- User role baseline
INSERT INTO role_permissions (role_id, page)
SELECT r.role_id, p.page FROM roles r, (VALUES
 ('dashboard'), ('calendar'), ('events'), ('main-help')
) AS p(page)
WHERE r.role_name = 'User' ON CONFLICT DO NOTHING;
-- HR role permissions
INSERT INTO role_permissions (role_id, page)
SELECT r.role_id, p.page FROM roles r, (VALUES
 ('dashboard'), ('calendar'), ('events'), ('event-definitions'), ('competencies'), ('main-help')
) AS p(page)
WHERE r.role_name = 'HR' ON CONFLICT DO NOTHING;

-- -----------------------------------------------------------------------------
-- Stage 4: Event Definitions (Depends on Competencies)
-- -----------------------------------------------------------------------------

INSERT INTO custom_event_definitions (event_name, activity_description, standard_duration, grants_certificate_id, facilitator, created_by) VALUES
('First Aid & CPR Recertification', 'A one-day course to renew First Aid Level 1 certification.', INTERVAL '8 hours', 1, 'St. John Ambulance', 'bobbrown'),
('Basic Widget Repair Training', 'A 3-day hands-on course for new technicians.', INTERVAL '3 days', 5, 'John Doe', 'johndoe'),
('Advanced Widget Repair Workshop', 'An expert-level workshop for senior staff. Prerequisite: Basic Widget Repair.', INTERVAL '2 days', 6, 'Mike Chen', 'johndoe'),
('Leadership Skills Seminar', 'Interactive seminar covering communication, delegation, and conflict resolution.', INTERVAL '1 day', 7, 'External Consultant', 'bobbrown')
ON CONFLICT DO NOTHING;

-- Define prerequisites for events
INSERT INTO custom_event_prerequisites (event_id, prerequisite_event_id) VALUES
(3, 2) ON CONFLICT DO NOTHING; -- Advanced Workshop requires Basic Training

-- -----------------------------------------------------------------------------
-- Stage 5: Event Schedules & Attendance (Final Layer)
-- -----------------------------------------------------------------------------

INSERT INTO custom_event_schedules (custom_event_id, title, event_start_date, event_end_date, room_name, maximum_attendees, minimum_attendees, status_name, color, created_by_user_id) VALUES
(1, 'PAST: First Aid - Q1', NOW() - INTERVAL '3 months', NOW() - INTERVAL '3 months' + INTERVAL '8 hours', 'Training Room A', 10, 4, 'Completed', '#28a745', (SELECT id FROM users WHERE username='bobbrown')),
(2, 'Basic Widget Repair - July', NOW() + INTERVAL '1 month', NOW() + INTERVAL '1 month' + INTERVAL '3 days', 'Workshop 1', 6, 2, 'Scheduled', '#007bff', (SELECT id FROM users WHERE username='johndoe')),
(3, 'Advanced Widget Repair - Aug', NOW() + INTERVAL '2 months', NOW() + INTERVAL '2 months' + INTERVAL '2 days', 'Workshop 2', 4, 2, 'Scheduled', '#ffc107', (SELECT id FROM users WHERE username='johndoe')),
(4, 'Leadership Seminar - July', NOW() + INTERVAL '25 days', NOW() + INTERVAL '25 days' + INTERVAL '1 day', 'Boardroom', 12, 5, 'Scheduled', '#17a2b8', (SELECT id FROM users WHERE username='bobbrown')),
(1, 'First Aid - July', NOW() + INTERVAL '15 days', NOW() + INTERVAL '15 days' + INTERVAL '8 hours', 'Training Room B', 10, 4, 'Full', '#6f42c1', (SELECT id FROM users WHERE username='bobbrown')),
(2, 'Basic Widget Repair - Aug', NOW() + INTERVAL '2 months', NOW() + INTERVAL '2 months' + INTERVAL '3 days', 'Workshop 1', 6, 2, 'Cancelled', '#dc3545', (SELECT id FROM users WHERE username='johndoe'))
ON CONFLICT DO NOTHING;

-- Link employees to schedules
INSERT INTO event_schedule_employees (custom_event_schedule_id, employee_number, role) VALUES
(2, 'E007', 'Attendee'), (2, 'E009', 'Attendee'),
(3, 'E001', 'Attendee'), (3, 'E006', 'Facilitator'),
(4, 'E004', 'Attendee'), (4, 'E005', 'Attendee'),
(5, 'E002', 'Attendee'), (5, 'E006', 'Attendee'), (5, 'E007', 'Attendee'), (5, 'E008', 'Attendee')
ON CONFLICT (custom_event_schedule_id, employee_number) DO NOTHING;

-- Link positions to schedules
INSERT INTO event_schedule_position_targets (custom_event_schedule_id, position_matrix_code) VALUES
(2, 'P001'), (2, 'P004'), (3, 'P003'), (4, 'P002'), (4, 'P005')
ON CONFLICT (custom_event_schedule_id, position_matrix_code) DO NOTHING;

-- Record attendance for the PAST event
INSERT INTO event_attendance (custom_event_schedule_id, employee_number, attended, check_in_time, check_out_time) VALUES
(1, 'E004', TRUE, NOW() - INTERVAL '3 months' + INTERVAL '1 minute', NOW() - INTERVAL '3 months' + INTERVAL '8 hours'),
(1, 'E005', TRUE, NOW() - INTERVAL '3 months' + INTERVAL '5 minutes', NOW() - INTERVAL '3 months' + INTERVAL '7 hours 50 minutes')
ON CONFLICT (custom_event_schedule_id, employee_number) DO NOTHING;

-- Grant competencies to employees
INSERT INTO employee_competencies (employee_number, competency_id, achievement_date, expiry_date, granted_by_schedule_id, notes) VALUES
-- Historical competencies
('E001', 5, '2020-01-15', NULL, NULL, 'Previous experience'),
('E001', 6, '2021-06-20', NULL, NULL, 'Previous experience'),
('E002', 1, '2023-08-01', '2026-08-01', NULL, 'External training'),
('E002', 5, '2022-03-10', NULL, NULL, 'On-the-job training'),
('E006', 5, '2022-03-10', NULL, NULL, 'Trained with Jane'),
-- Competencies from the completed event (schedule_id=1)
('E004', 1, (SELECT (event_start_date)::date FROM custom_event_schedules WHERE custom_event_schedule_id=1), (SELECT (event_start_date + INTERVAL '36 months')::date FROM custom_event_schedules WHERE custom_event_schedule_id=1), 1, 'Completed course.'),
('E005', 1, (SELECT (event_start_date)::date FROM custom_event_schedules WHERE custom_event_schedule_id=1), (SELECT (event_start_date + INTERVAL '36 months')::date FROM custom_event_schedules WHERE custom_event_schedule_id=1), 1, 'Completed course.')
ON CONFLICT (employee_number, competency_id, achievement_date) DO NOTHING;


-- =============================================================================